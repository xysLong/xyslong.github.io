{{ define "main" }}

<style>
    .lab-intro-wrapper {
        max-width: 1000px;
        margin: 3rem auto;
        padding: 0 1rem;
    }

    .lab-intro-header {
        text-align: left;
        margin-bottom: 2rem;
    }

    .lab-intro-header h1 {
        font-size: 1.75rem;
        margin-bottom: 0.3rem;
        color: #222;
    }

    .lab-intro-header h2 {
        font-size: 1.25rem;
        color: #555;
    }

    .lab-intro-content {
        display: grid;
        grid-template-columns: 1fr 250px;
        gap: 2rem;
        align-items: start;
    }

    .lab-intro-text p {
        font-size: 1rem;
        line-height: 1.6;
        color: #444;
    }

    .lab-intro-logo {
        text-align: center;
    }

    .lab-intro-logo img {
        max-width: 100%;
        max-height: 180px;
        object-fit: contain;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .lab-intro-content {
            grid-template-columns: 1fr;
            text-align: center;
        }

        .lab-intro-text p {
            text-align: left;
            margin-top: 1rem;
        }
    }
</style>

<div class="lab-intro-wrapper">
    <div class="lab-intro-header">
        <h1>Lab for Cognitive Research in Art History (CReA)</h1>
        <h2>University of Vienna</h2>
    </div>
    <div class="lab-intro-content">
        <div class="lab-intro-text">
            <p>
                The aim of the CReA lab is to expand art historical knowledge through the use of empirical and
                experimental methods.
                The laboratory's projects deal with traditional art historical questions about artworks and their
                perception as well as transdisciplinary issues of empirical aesthetics, visual culture and museology.
            </p>
        </div>
        <div class="lab-intro-logo">
            <img src="/images/crealab/crea_logo.png" alt="CReA Logo">
        </div>
    </div>
</div>

<style>
    .view-toggle {
        padding: 0.5rem 1rem;
        margin: 0 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        background-color: white;
        cursor: pointer;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .view-toggle.active {
        background-color: #2daa68;
        color: white;
        border-color: #2daa68;
    }
</style>


<div style="text-align: center; margin: 2rem auto;">
    <button id="toggle-people" class="view-toggle active">Meet Our People</button>
    <button id="toggle-projects" class="view-toggle">See Our Projects</button>
    <button id="toggle-exchanges" class="view-toggle">Academic Exchanges</button>
</div>

{{ partial "crealab/people.html" . }}
{{ partial "crealab/projects.html" . }}
{{ partial "crealab/exchanges.html" . }}

<script>
    document.getElementById('toggle-people').addEventListener('click', () => {
        document.getElementById('people-view').style.display = 'block';
        document.getElementById('projects-view').style.display = 'none';
        document.getElementById('exchanges-view').style.display = 'none';
        document.getElementById('toggle-people').classList.add('active');
        document.getElementById('toggle-projects').classList.remove('active');
        document.getElementById('toggle-exchanges').classList.remove('active');
    });

    document.getElementById('toggle-projects').addEventListener('click', () => {
        document.getElementById('people-view').style.display = 'none';
        document.getElementById('projects-view').style.display = 'block';
        document.getElementById('exchanges-view').style.display = 'none';
        document.getElementById('toggle-people').classList.remove('active');
        document.getElementById('toggle-projects').classList.add('active');
        document.getElementById('toggle-exchanges').classList.remove('active');
    });

    document.getElementById('toggle-exchanges').addEventListener('click', () => {
        document.getElementById('people-view').style.display = 'none';
        document.getElementById('projects-view').style.display = 'none';
        document.getElementById('exchanges-view').style.display = 'block';
        document.getElementById('toggle-people').classList.remove('active');
        document.getElementById('toggle-projects').classList.remove('active');
        document.getElementById('toggle-exchanges').classList.add('active');
    });
</script>

<script>
    document.querySelectorAll('.lab-grid').forEach(section => {
        const items = Array.from(section.children);
        const atTopItems = items.filter(item => item.dataset.isAtTop === "true");
        const notAtTopItems = items.filter(item => item.dataset.isAtTop === "false");

        for (let i = notAtTopItems.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [notAtTopItems[i], notAtTopItems[j]] = [notAtTopItems[j], notAtTopItems[i]];
        }

        section.innerHTML = '';
        atTopItems.forEach(el => section.appendChild(el));
        notAtTopItems.forEach(el => section.appendChild(el));
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const fallbackImages = [
            "da_vinci_1.png",
            "da_vinci_2.png",
            "kahlo.png",
            "klimt.png",
            "munch.png",
            "van_eyck.png",
            "vermeer.png",
            "whistler.png",
            "wood_f.png",
            "wood_m.png",
        ];

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        const shuffledPortraits = shuffleArray([...fallbackImages]);
        const assignedPortraits = {};
        let portraitIndex = 0;

        document.querySelectorAll('img').forEach(img => {
            const src = img.getAttribute('src');
            const alt = img.getAttribute('alt'); // person name
            const isPeopleImage = src.includes("/images/crealab/people/");
            const isMissingPhoto = src.endsWith("/default.png");

            if (isPeopleImage && isMissingPhoto && alt) {
                if (!assignedPortraits[alt]) {
                    assignedPortraits[alt] = shuffledPortraits[portraitIndex % shuffledPortraits.length];
                    portraitIndex++;
                }

                img.src = `/images/crealab/portraits/${assignedPortraits[alt]}`;
            }
        });
    });
</script>


{{ end }}
